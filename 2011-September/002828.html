<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-dev/2011-September/index.html" >
   <LINK REL="made" HREF="mailto:x2go-dev%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Dev%5D%20X2Go%20printing%20crash%20%5Bwas%3A%20libssh%2C%20nagle%2C%0A%20and%20performance%20issues%5D&In-Reply-To=%3C1316640005.1082.157.camel%40denise.theartistscloset.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002827.html">
   <LINK REL="Next"  HREF="002829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]</H1>
    <B>John A. Sullivan III</B> 
    <A HREF="mailto:x2go-dev%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Dev%5D%20X2Go%20printing%20crash%20%5Bwas%3A%20libssh%2C%20nagle%2C%0A%20and%20performance%20issues%5D&In-Reply-To=%3C1316640005.1082.157.camel%40denise.theartistscloset.com%3E"
       TITLE="[X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]">jsullivan at opensourcedevel.com
       </A><BR>
    <I>Wed Sep 21 23:20:05 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002827.html">[X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]
</A></li>
        <LI>Next message: <A HREF="002829.html">[X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2828">[ date ]</a>
              <a href="thread.html#2828">[ thread ]</a>
              <a href="subject.html#2828">[ subject ]</a>
              <a href="author.html#2828">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2011-09-21 at 16:55 -0400, John A. Sullivan III wrote:
&gt;<i> On Tue, 2011-09-20 at 20:15 +0200, Mike Gabriel wrote:
</I>&gt;<i> &gt; Hi John,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Di 20 Sep 2011 18:27:24 CEST &quot;Jhn A. Sullivan III&quot; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; &lt;snip&gt;
</I>&gt;<i> &gt; &gt; I doubt it as the problem is one the client side and not the server
</I>&gt;<i> &gt; &gt; side.  All our changes were to the server.  This is in the Squeeze
</I>&gt;<i> &gt; &gt; client and not Windows - John
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 1.
</I>&gt;<i> &gt; Does the problem disappear with the latest x2goclient (built today  
</I>&gt;<i> &gt; around 4pm CEST).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 2.
</I>&gt;<i> &gt; Can you send me the ,,printing'' config file in ~/.x2goclient?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 3.
</I>&gt;<i> &gt; Can you send me /etc/cups/printers.conf?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; Mike
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i> Just tried.  It still crashes.  Here is /etc/cups/printers.conf:
</I>&gt;<i> # Printer configuration file for CUPS v1.4.4
</I>&gt;<i> # Written by cupsd
</I>&gt;<i> # DO NOT EDIT THIS FILE WHEN CUPSD IS RUNNING
</I>&gt;<i> &lt;DefaultPrinter HP_2605dn&gt;
</I>&gt;<i> Info HP2605dn
</I>&gt;<i> Location Kennebunk
</I>&gt;<i> MakeModel HP Color LaserJet 2605dn Foomatic/Postscript
</I>&gt;<i> DeviceURI <A HREF="socket://192.168.223.99:9100">socket://192.168.223.99:9100</A>
</I>&gt;<i> State Idle
</I>&gt;<i> StateTime 1311624159
</I>&gt;<i> Type 8400924
</I>&gt;<i> Filter application/vnd.cups-raw 0 -
</I>&gt;<i> Filter application/vnd.cups-postscript 100 foomatic-rip
</I>&gt;<i> Filter application/vnd.cups-pdf 0 foomatic-rip
</I>&gt;<i> Accepting Yes
</I>&gt;<i> Shared No
</I>&gt;<i> JobSheets none none
</I>&gt;<i> QuotaPeriod 0
</I>&gt;<i> PageLimit 0
</I>&gt;<i> KLimit 0
</I>&gt;<i> OpPolicy default
</I>&gt;<i> ErrorPolicy stop-printer
</I>&gt;<i> &lt;/Printer&gt;
</I>&gt;<i> 
</I>&gt;<i> and here is .x2goclient/printing:
</I>&gt;<i> [General]
</I>&gt;<i> showdialog=true
</I>&gt;<i> pdfview=false
</I>&gt;<i> 
</I>&gt;<i> [print]
</I>&gt;<i> startcmd=false
</I>&gt;<i> command=lpr
</I>&gt;<i> stdin=false
</I>&gt;<i> ps=false
</I>&gt;<i> 
</I>&gt;<i> [view]
</I>&gt;<i> open=true
</I>&gt;<i> command=kpdf
</I>&gt;<i> 
</I>&gt;<i> [CUPS]
</I>&gt;<i> defaultprinter=HP_2605dn
</I>&gt;<i> options\HP2605=&quot;Duplex=DuplexTumble&quot;, &quot;HPColorSmart=Manual&quot;,
</I>&gt;<i> &quot;ColorModel=Gray1200x1200dpi&quot;
</I>&gt;<i> options\HP2605dn=&quot;Duplex=DuplexNoTumble&quot;,
</I>&gt;<i> &quot;CMAndResolution=Gray600x600dpi&quot;
</I>&gt;<i> options\HP_2605dn=&quot;Duplex=DuplexNoTumble&quot;
</I>&gt;<i> 
</I>&gt;<i> I took an strace but it does not reveal a lot.  Here are pertinent
</I>&gt;<i> sections from the end of x2gotrace.3420:
</I>&gt;<i> 
</I>&gt;<i> time(NULL)                              = 1316637069
</I>&gt;<i> time(NULL)                              = 1316637069
</I>&gt;<i> recv(29, &quot;-hold-until-default\0\7no-hold!\0\24j&quot;..., 2048, 0) = 2048
</I>&gt;<i> time(NULL)                              = 1316637069
</I>&gt;<i> recv(29, &quot;utionD\0\0\0\5sidesD\0\30job-hold-until&quot;..., 2048, 0) = 2048
</I>&gt;<i> time(NULL)                              = 1316637069
</I>&gt;<i> recv(29, &quot;\4\0\0\0&amp;#\0\0\0\4\0\0@\1#\0\0\0\4\0\0@\2#\0\0\0\4\0\0@\3&quot;...,
</I>&gt;<i> 448, 0) = 448
</I>&gt;<i> time(NULL)                              = 1316637069
</I>&gt;<i> open(&quot;/etc/cups/lpoptions&quot;, O_RDONLY|O_LARGEFILE) = -1 ENOENT (No such
</I>&gt;<i> file or directory)
</I>&gt;<i> access(&quot;/home/jsullivan/.cups/lpoptions&quot;, F_OK) = -1 ENOENT (No such
</I>&gt;<i> file or directory)
</I>&gt;<i> open(&quot;/home/jsullivan/.lpoptions&quot;, O_RDONLY|O_LARGEFILE) = -1 ENOENT (No
</I>&gt;<i> such file or directory)
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2goclient/printing&quot;, {st_mode=S_IFREG|0755,
</I>&gt;<i> st_size=369, ...}) = 0
</I>&gt;<i> open(&quot;/home/jsullivan/.x2goclient/printing&quot;, O_RDONLY|O_LARGEFILE|
</I>&gt;<i> O_CLOEXEC) = 31
</I>&gt;<i> fcntl64(31, F_SETFD, FD_CLOEXEC)        = 0
</I>&gt;<i> fstat64(31, {st_mode=S_IFREG|0755, st_size=369, ...}) = 0
</I>&gt;<i> close(31)                               = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2goclient/printing&quot;, {st_mode=S_IFREG|0755,
</I>&gt;<i> st_size=369, ...}) = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2goclient/printing&quot;, {st_mode=S_IFREG|0755,
</I>&gt;<i> st_size=369, ...}) = 0
</I>&gt;<i> stat64(&quot;/etc/localtime&quot;, {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0
</I>&gt;<i> stat64(&quot;/etc/cups/ppd/HP_2605dn.ppd&quot;, {st_mode=S_IFREG|0644,
</I>&gt;<i> st_size=9953, ...}) = 0
</I>&gt;<i> gettimeofday({1316637069, 848633}, NULL) = 0
</I>&gt;<i> symlink(&quot;/etc/cups/ppd/HP_2605dn.ppd&quot;, &quot;/tmp/4e7a498dcf2f9&quot;) = 0
</I>&gt;<i> open(&quot;/tmp/4e7a498dcf2f9&quot;, O_RDONLY|O_LARGEFILE) = 31
</I>&gt;<i> fcntl64(31, F_GETFD)                    = 0
</I>&gt;<i> fcntl64(31, F_SETFD, FD_CLOEXEC)        = 0
</I>&gt;<i> read(31, &quot;*PPD-Adobe: \&quot;4.3\&quot;\n*%\n*% For info&quot;..., 4096) = 4096
</I>&gt;<i> read(31, &quot;\n*PageRegion Letter/US Letter: \&quot;&quot;..., 4096) = 4096
</I>&gt;<i> read(31, &quot;Standard \&quot;(001.004S)\&quot; Standard R&quot;..., 4096) = 1761
</I>&gt;<i> read(31, &quot;&quot;, 4096)                      = 0
</I>&gt;<i> read(31, &quot;&quot;, 4096)                      = 0
</I>&gt;<i> close(31)                               = 0
</I>&gt;<i> unlink(&quot;/tmp/4e7a498dcf2f9&quot;)            = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2goclient/printing&quot;, {st_mode=S_IFREG|0755,
</I>&gt;<i> st_size=369, ...}) = 0
</I>&gt;<i> open(&quot;/home/jsullivan/.x2goclient/printing&quot;, O_RDONLY|O_LARGEFILE|
</I>&gt;<i> O_CLOEXEC) = 31
</I>&gt;<i> fcntl64(31, F_SETFD, FD_CLOEXEC)        = 0
</I>&gt;<i> fstat64(31, {st_mode=S_IFREG|0755, st_size=369, ...}) = 0
</I>&gt;<i> close(31)                               = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2goclient/printing&quot;, {st_mode=S_IFREG|0755,
</I>&gt;<i> st_size=369, ...}) = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2goclient/printing&quot;, {st_mode=S_IFREG|0755,
</I>&gt;<i> st_size=369, ...}) = 0
</I>&gt;<i> stat64(&quot;/etc/localtime&quot;, {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0
</I>&gt;<i> time(NULL)                              = 1316637070
</I>&gt;<i> time(NULL)                              = 1316637070
</I>&gt;<i> .
</I>&gt;<i> .
</I>&gt;<i> .
</I>&gt;<i> .
</I>&gt;<i> time(NULL)                              = 1316637071
</I>&gt;<i> time(NULL)                              = 1316637071
</I>&gt;<i> clock_gettime(CLOCK_MONOTONIC, {709, 441819023}) = 0
</I>&gt;<i> select(13, [12], NULL, NULL, {0, 0})    = 0 (Timeout)
</I>&gt;<i> clock_gettime(CLOCK_MONOTONIC, {709, 444143062}) = 0
</I>&gt;<i> open(&quot;/home/jsullivan/.x2go/S-jasiii-53-1316636661_stDKDE_dp24/spool&quot;,
</I>&gt;<i> O_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY|O_CLOEXEC) = 31
</I>&gt;<i> statfs(&quot;/home/jsullivan/.x2go/S-jasiii-53-1316636661_stDKDE_dp24/spool&quot;,
</I>&gt;<i> {f_type=&quot;EXT2_SUPER_MAGIC&quot;, f_bsize=4096, f_blocks=12812451,
</I>&gt;<i> f_bfree=11505345, f_bavail=11375175, f_f
</I>&gt;<i> getdents(31, /* 3 entries */, 32768)    = 76
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2go/S-jasiii-53-1316636661_stDKDE_dp24/spool/.&quot;, {st_mode=S_IFDIR|0700, st_size=4096, ...}) = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2go/S-jasiii-53-1316636661_stDKDE_dp24/spool/13008-jasiii-cupsjob13904.pdf&quot;, {st_mode=S_IFREG|0644, st_size=23397, ...}) = 0
</I>&gt;<i> getdents(31, /* 0 entries */, 32768)    = 0
</I>&gt;<i> close(31)                               = 0
</I>&gt;<i> stat64(&quot;/home/jsullivan/.x2go/S-jasiii-53-1316636661_stDKDE_dp24/spool/..&quot;, {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
</I>&gt;<i> clock_gettime(CLOCK_MONOTONIC, {709, 729349572}) = 0
</I>&gt;<i> poll([{fd=7, events=POLLIN|POLLOUT}], 1, -1) = 1 ([{fd=7,
</I>&gt;<i> revents=POLLOUT}])
</I>&gt;<i> writev(7, [{&quot;\224\7\2\0\0\22\200\3\22\0\n\0\377\21\200\3[\1\0\0[\1\0\0
</I>&gt;<i> \10\21\200\3\20\0\0\0&quot;..., 96}, {NULL, 0}, {&quot;&quot;, 0}], 3) = 96
</I>&gt;<i> read(7, &quot;\34\0\335b\377\21\200\3[\1\0\0\234\324\n\0\0\0\0\0\0\0\0\0\0\0
</I>&gt;<i> \0\0\0\0\0\0&quot;..., 4096) = 704
</I>&gt;<i> read(7, 0x9bede30, 4096)                = -1 EAGAIN (Resource
</I>&gt;<i> temporarily unavailable)
</I>&gt;<i> read(7, 0x9bede30, 4096)                = -1 EAGAIN (Resource
</I>&gt;<i> temporarily unavailable)
</I>&gt;<i> munmap(0xb5b82000, 65932)               = 0
</I>&gt;<i> munmap(0xb5ab5000, 633604)              = 0
</I>&gt;<i> munmap(0xb5aa6000, 58716)               = 0
</I>&gt;<i> munmap(0xb5894000, 584396)              = 0
</I>&gt;<i> poll([{fd=7, events=POLLIN|POLLOUT}], 1, -1) = 1 ([{fd=7,
</I>&gt;<i> revents=POLLOUT}])
</I>&gt;<i> writev(7, [{&quot;\224\7\2\0\31\0\200\3\22\0\n\0\30\0\200\3[\1\0\0[\1\0\0\10
</I>&gt;<i> \21\200\3\20\0\0\0&quot;..., 3372}, {NULL, 0}, {&quot;&quot;, 0}], 3) = 3372
</I>&gt;<i> poll([{fd=7, events=POLLIN}], 1, -1)    = 1 ([{fd=7, revents=POLLIN}])
</I>&gt;<i> read(7, &quot;\34\0\345b\30\0\200\3[\1\0\0N\325\n\0\0\0\0\0\0\0\0\0\0\0\0\0\0
</I>&gt;<i> \0\0\0&quot;..., 4096) = 1376
</I>&gt;<i> read(7, 0x9bede30, 4096)                = -1 EAGAIN (Resource
</I>&gt;<i> temporarily unavailable)
</I>&gt;<i> poll([{fd=7, events=POLLIN|POLLOUT}], 1, -1) = 1 ([{fd=7,
</I>&gt;<i> revents=POLLIN|POLLOUT}])
</I>&gt;<i> read(7, &quot;\26\0\201du\1\200\1u\1\200\1\0\0\0\0\0\0\0\0t\0\36\0\0\0\0\0\0
</I>&gt;<i> \0\0\0&quot;, 4096) = 32
</I>&gt;<i> writev(7, [{&quot;O\7\2\0\1\0\200\3&lt;\0\2\0\0\0\200\3.\1\2\0\5\0\200\3+\21\1
</I>&gt;<i> \0&quot;, 28}, {NULL, 0}, {&quot;&quot;, 0}], 3) = 28
</I>&gt;<i> poll([{fd=7, events=POLLIN}], 1, -1)    = 1 ([{fd=7, revents=POLLIN}])
</I>&gt;<i> read(7, &quot;\1\1\205d\0\0\0\0\6\0`\3\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0
</I>&gt;<i> \0&quot;, 4096) = 32
</I>&gt;<i> read(7, 0x9bede30, 4096)                = -1 EAGAIN (Resource
</I>&gt;<i> temporarily unavailable)
</I>&gt;<i> close(7)                                = 0
</I>&gt;<i> write(8, &quot;\1\v\1\0\1\0\0\0\0\0\0\0\0\0\0\0&quot;, 16) = 16
</I>&gt;<i> close(8)                                = 0
</I>&gt;<i> open(&quot;/proc/stat&quot;, O_RDONLY|O_CLOEXEC)  = 7
</I>&gt;<i> read(7, &quot;cpu  53876 11825 26767 40263 127&quot;..., 8192) = 2875
</I>&gt;<i> close(7)                                = 0
</I>&gt;<i> write(6, &quot;@&quot;, 1)                        = 1
</I>&gt;<i> close(6)                                = 0
</I>&gt;<i> close(5)                                = 0
</I>&gt;<i> rt_sigaction(SIGCHLD, {SIG_DFL, [], SA_NOCLDSTOP}, {0xb68cc3b0, [],
</I>&gt;<i> SA_NOCLDSTOP}, 8) = 0
</I>&gt;<i> exit_group(0)                           = ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I tried to intercept it with ddd but that didn't work.  Interestingly,
</I>&gt;<i> its messages were that the program closed normally as if x2goprinting is
</I>&gt;<i> invoking a close event.  I'll see what I can do to get this to run from
</I>&gt;<i> a debugger but it is a showstopping bug for us - John
</I>&lt;snip&gt;
Well this is bizarre.  I just ran x2goclient in Qt-Creator and used its
debugger.  Similar to ddd, no indication of a segfault.

I set a breakpont in PrintDialog::accept().  While I was deciding what
to do next, I started receiving &quot;no response received&quot; error messages
from the client session I had opened.

Eventually , I stepped through to PrintProcess::loadSettings() and the 
if ( dlg.exec() ==QDialog::Rejected ) line and it stuck there.  Stepping
over, Stepping out all brought me back to that line.  I finally just did
a run and my client was gone.  No seg fault - just a clean client exit
as a result of printing! Any ideas? - John


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002827.html">[X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]
</A></li>
	<LI>Next message: <A HREF="002829.html">[X2go-Dev] X2Go printing crash [was: libssh, nagle, and performance issues]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2828">[ date ]</a>
              <a href="thread.html#2828">[ thread ]</a>
              <a href="subject.html#2828">[ subject ]</a>
              <a href="author.html#2828">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-dev">More information about the X2Go-Dev
mailing list</a><br>
</body></html>
