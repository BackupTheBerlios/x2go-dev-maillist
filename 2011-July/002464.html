<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Dev] x2goserver package with setuidwrapper
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-dev/2011-July/index.html" >
   <LINK REL="made" HREF="mailto:x2go-dev%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Dev%5D%20x2goserver%20package%20with%20setuidwrapper&In-Reply-To=%3C20110717134105.12113c0z36ov31ox%40mail.das-netzwerkteam.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002463.html">
   <LINK REL="Next"  HREF="002472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Dev] x2goserver package with setuidwrapper</H1>
    <B>Mike Gabriel</B> 
    <A HREF="mailto:x2go-dev%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Dev%5D%20x2goserver%20package%20with%20setuidwrapper&In-Reply-To=%3C20110717134105.12113c0z36ov31ox%40mail.das-netzwerkteam.de%3E"
       TITLE="[X2go-Dev] x2goserver package with setuidwrapper">mike.gabriel at das-netzwerkteam.de
       </A><BR>
    <I>Sun Jul 17 13:41:05 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002463.html">[X2go-Dev] x2goserver package with setuidwrapper
</A></li>
        <LI>Next message: <A HREF="002472.html">[X2go-Dev] x2goserver package with setuidwrapper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2464">[ date ]</a>
              <a href="thread.html#2464">[ thread ]</a>
              <a href="subject.html#2464">[ subject ]</a>
              <a href="author.html#2464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Reinhard,

thanks for taking a first closer look!!!

On So 17 Jul 2011 12:18:49 CEST Reinhard Tartler wrote:

&gt;<i> Well, the changes in git are somewhat convoluted and take me a
</I>&gt;<i> considerable time to review properly. I don't know if and when I have
</I>&gt;<i> time to do a proper review in the near future, but here are my first
</I>&gt;<i> observations:
</I>&gt;<i>
</I>&gt;<i>  - the clean rule needs work:
</I>&gt;<i>    - x2goserver/x2gosqlitewrapper is not deleted
</I>
Ok.

&gt;<i>    - x2goserver-extensions/.build_man2html and
</I>&gt;<i>      x2goserver/.build_man2html should be deleted from the branch, as
</I>&gt;<i>      the content is autogenerated
</I>
Ok. Will add that. I commit the html man pages to Git as they are  
linked from the X2go wiki, so that we have man pages available TTW.  
There might be another way of doing this easily, but this was my  
spontaneous approach to make man pages (incl. regular updates)  
available TTW.

&gt;<i>  - /usr/lib/x2go/x2gosqlitewrapper.pl is still installed suid, while
</I>&gt;<i>    /usr/bin/x2gosqlitewrapper is not. Is this really intended? If it is,
</I>&gt;<i>    then the whole design is somewhat mysterious to me.
</I>
   o /usr/bin/x2gosqlitewrapper is the setuidwrapper and is started as  
the user,
     who runs the X2go session (e.g. user foo), this C binary has to be set
     root:root:0755.
   o /usr/lib/x2go/x2gosqlitewrapper.pl is the actual Perl script that has to
     run as user ,,x2guser''. This file has to be set x2gouser:x2gousers:6755.

As user foo I execute /usr/bin/x2gosqlitewrapper, this wraps an  
execvpe call around the Perl script  
/usr/lib/x2go/x2gosqlitewrapper.pl. The execvpe call
evokes a change of the effective UID/GID as  
/usr/lib/x2go/x2gosqlitewrapper.pl has its setuid bit set.

What you can try out is: do a chmod 6755 /usr/bin/X2gosqlitewrapper  
and a chown x2gouser:x2gousers /usr/bin/x2gosqlitewrapper and then  
call x2golistsessions (on a server that uses sqlite as X2go db  
backend). You will get a kernel complaint (or libc) that this is not  
allowed with the current kernel configuration.

&gt;<i>  - the wrapper itself uses a static buffer to copy the link of
</I>&gt;<i>    /proc/self/exe there. this makes sense, but where does BUFSIZ come
</I>&gt;<i>    from and how big is it? Do we have enough control over the
</I>&gt;<i>    buildsystem so that it doesn't for some reason gets too small? TBH,
</I>&gt;<i>    I'd rather go with dynamic memory allocation here.
</I>
I am not a C coder at all, so I basically copy+pasted snippets from  
the internet. I wil be happy to learn how this could be changed into a  
more secure bit of code. I will be glad, if you could provide a change  
for this and commit it to Git.

&gt;<i>  - remark for the future, maybe the whole sqlitewrapper.pl can/should be
</I>&gt;<i>    implemented in C?
</I>
Might it be an idea to extend that on the complete server code? C code  
is just a PITA to debug compared to interpreter languages...

Greets+Thanks,
Mike

-- 

DAS-NETZWERKTEAM
mike gabriel, dorfstr. 27, 24245 barmissen
fon: +49 (4302) 281418, fax: +49 (4302) 281419

GnuPG Key ID 0xB588399B
mail: <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-dev">mike.gabriel at das-netzwerkteam.de</A>, <A HREF="http://das-netzwerkteam.de">http://das-netzwerkteam.de</A>

freeBusy:
<A HREF="https://mail.das-netzwerkteam.de/freebusy/m.gabriel%40das-netzwerkteam.de.xfb">https://mail.das-netzwerkteam.de/freebusy/m.gabriel%40das-netzwerkteam.de.xfb</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 490 bytes
Desc: Digitale PGP-Unterschrift
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/x2go-dev/attachments/20110717/f8a36779/attachment.pgp">https://lists.berlios.de/pipermail/x2go-dev/attachments/20110717/f8a36779/attachment.pgp</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002463.html">[X2go-Dev] x2goserver package with setuidwrapper
</A></li>
	<LI>Next message: <A HREF="002472.html">[X2go-Dev] x2goserver package with setuidwrapper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2464">[ date ]</a>
              <a href="thread.html#2464">[ thread ]</a>
              <a href="subject.html#2464">[ subject ]</a>
              <a href="author.html#2464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-dev">More information about the X2Go-Dev
mailing list</a><br>
</body></html>
