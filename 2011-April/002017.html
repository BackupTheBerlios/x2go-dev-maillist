<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-dev] [X2go-user] 10x printing speed	increase	for	x2go	printing
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-dev/2011-April/index.html" >
   <LINK REL="made" HREF="mailto:x2go-dev%40lists.berlios.de?Subject=Re%3A%20%5BX2go-dev%5D%20%5BX2go-user%5D%2010x%20printing%20speed%0A%09increase%09for%09x2go%09printing&In-Reply-To=%3Ce7155377-8612-41df-9545-6d5066cce352%40office.splatnix.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002016.html">
   <LINK REL="Next"  HREF="002018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-dev] [X2go-user] 10x printing speed	increase	for	x2go	printing</H1>
    <B>--[ UxBoD ]--</B> 
    <A HREF="mailto:x2go-dev%40lists.berlios.de?Subject=Re%3A%20%5BX2go-dev%5D%20%5BX2go-user%5D%2010x%20printing%20speed%0A%09increase%09for%09x2go%09printing&In-Reply-To=%3Ce7155377-8612-41df-9545-6d5066cce352%40office.splatnix.net%3E"
       TITLE="[X2go-dev] [X2go-user] 10x printing speed	increase	for	x2go	printing">uxbod at splatnix.net
       </A><BR>
    <I>Tue Apr 12 17:37:48 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002016.html">[X2go-dev] [X2go-user] 10x printing speed increase	for	x2go	printing
</A></li>
        <LI>Next message: <A HREF="002018.html">[X2go-dev] [X2go-user] 10x printing speed increase for x2go	printing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2017">[ date ]</a>
              <a href="thread.html#2017">[ thread ]</a>
              <a href="subject.html#2017">[ subject ]</a>
              <a href="author.html#2017">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>----- Original Message -----
&gt;<i> ----- Original Message -----
</I>&gt;<i> &gt; ----- Original Message -----
</I>&gt;<i> &gt; &gt; Hi Phil,
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; On Mo 11 Apr 2011 13:25:55 CEST &quot;--[ UxBoD ]--&quot; wrote:
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; &gt; ----- Original Message -----
</I>&gt;<i> &gt; &gt; &gt;&gt; Hi Phil,
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; On Mo 11 Apr 2011 12:07:57 CEST &quot;--[ UxBoD ]--&quot; wrote:
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; Yep that is my interpretation of the process as-well, Mike.
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; One
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; thing I have noticed is that if you print the resultant PDF
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; the
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; file
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; is left in the spool directory without being deleted; yet if
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; you
</I>&gt;<i> &gt; &gt; &gt;&gt; &gt; cancel from the x2go-print dialogue box the file is removed.
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; is that x2goclient or PyHoca-GUI/Python X2go? With PyHoca-GUI
</I>&gt;<i> &gt; &gt; &gt;&gt; this
</I>&gt;<i> &gt; &gt; &gt;&gt; should not happen, otherwise it is a bug I have missed so
</I>&gt;<i> &gt; &gt; &gt;&gt; far...
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; Greets,
</I>&gt;<i> &gt; &gt; &gt;&gt; Mike
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; x2goclient 3.01.18.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; we have an unofficial bugtracker that we (the devs and the
</I>&gt;<i> &gt; &gt; community)
</I>&gt;<i> &gt; &gt; still have to discuss about. However, maybe you place such stuff
</I>&gt;<i> &gt; &gt; in
</I>&gt;<i> &gt; &gt; there already. In case of dropping the software again (Horde) we
</I>&gt;<i> &gt; &gt; will
</I>&gt;<i> &gt; &gt; surely migrate the already placed-in tickets.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; The chance of forgetting such tiny issues without accounting is
</I>&gt;<i> &gt; &gt; otherwise potentially given...
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Greets,
</I>&gt;<i> &gt; &gt; Mike
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Mike,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I think I may have worked out why some print jobs are failing and
</I>&gt;<i> &gt; it
</I>&gt;<i> &gt; would appear to be an x2go issue and not SSHFS/WAN.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What is happening is that the Perl script, x2goprint, moves the PDF
</I>&gt;<i> &gt; from /var/spool/x2goprint into the users mounted spool directory
</I>&gt;<i> &gt; and
</I>&gt;<i> &gt; then creates the .ready file. The x2goclient looks for any new
</I>&gt;<i> &gt; files
</I>&gt;<i> &gt; in that directory and if it sees the .ready file it pops up the
</I>&gt;<i> &gt; x2go
</I>&gt;<i> &gt; print dialogue window. Now, looking at the code it appears to
</I>&gt;<i> &gt; remove
</I>&gt;<i> &gt; the file as-well; in 3.01-18 the pertinent code is in
</I>&gt;<i> &gt; onmainwindow_part4.cpp line 200.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I am thinking this is a timing issue with respect to the .ready
</I>&gt;<i> &gt; file
</I>&gt;<i> &gt; being written and the slot which monitors the local spool directory
</I>&gt;<i> &gt; firing off an event.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Just not sure how to solve it yet :(
</I>&gt;<i> 
</I>&gt;<i> Okay, in onmainwindow_part4 here is the bit of code which I believe
</I>&gt;<i> is causing the issue:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
</I>&gt;<i>             continue;
</I>&gt;<i>         bool startProc=false;
</I>&gt;<i>         QString fname,title;
</I>&gt;<i>         if ( !file.atEnd() )
</I>&gt;<i> 
</I>&gt;<i> My theory is that a lock still exists on the .ready file for which
</I>&gt;<i> the file.open() cannot be called and therefore the code continues
</I>&gt;<i> and ultimately removes the .ready file; taking into account the loop
</I>&gt;<i> I put into x2goprint the script sees that the file has disappeared
</I>&gt;<i> and writes it again. This is why I believe we see a different count
</I>&gt;<i> number each time.
</I>&gt;<i> 
</I>&gt;<i> Any thoughts on how to resolve this one ?
</I>
Reading the Qt document I see:

&quot;Returns true if the current read and write position is at the end of the device (i.e. there is no more data available for reading on the device); otherwise returns false.
For some devices, atEnd() can return true even though there is more data to read. This special case only applies to devices that generate data in direct response to you calling read() (e.g., /dev or /proc files on Unix and Mac OS X, or console input / stdin on all platforms).&quot;

I am guessing that when the perl script opens the file for writing the x2go client is so quick and sees that it is at the end straight away; drops past the if loop and then removes the .ready file.


        if ( !file.atEnd() )
        {
            QByteArray line = file.readLine();
            QString fn ( line );
            fn.replace ( &quot;\n&quot;,&quot;&quot; );
            fname=fn;
            if ( !file.atEnd() )
            {
                line = file.readLine();
                title=line;
                title.replace ( &quot;\n&quot;,&quot;&quot; );
            }
            startProc=true;
        }

Perhaps one approach would be to keep looping through the .ready file until it reads an EOF marker ? Then the writing process has truly completed.
-- 
Thanks, Phil

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002016.html">[X2go-dev] [X2go-user] 10x printing speed increase	for	x2go	printing
</A></li>
	<LI>Next message: <A HREF="002018.html">[X2go-dev] [X2go-user] 10x printing speed increase for x2go	printing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2017">[ date ]</a>
              <a href="thread.html#2017">[ thread ]</a>
              <a href="subject.html#2017">[ subject ]</a>
              <a href="author.html#2017">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-dev">More information about the X2Go-Dev
mailing list</a><br>
</body></html>
